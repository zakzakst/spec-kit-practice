---
url: https://learn.microsoft.com/ja-jp/azure/architecture/ai-ml/guide/ai-agent-design-patterns
---

# AI エージェントオーケストレーションパターン

## 適切なレベルの複雑さから始める

マルチエージェント オーケストレーション パターンを採用する前に、シナリオに必要かどうかを評価します。エージェント アーキテクチャはさまざまな複雑さに存在し、各レベルでは調整のオーバーヘッド、待機時間、コストが発生します。要件を確実に満たす最も低いレベルの複雑さを使用します。

### 直接モデル呼び出し

| 項目           | 内容                                                                                                             |
| -------------- | ---------------------------------------------------------------------------------------------------------------- |
| 概要           | 適切に作成されたプロンプトを使用した 1 つの言語モデル呼び出し。 エージェント ロジックなし、ツール アクセスなし。 |
| いつ使用するか | モデルが 1 回のパスで完了できる分類、要約、翻訳、およびその他の単一ステップ タスク。                             |
| 考慮事項       | 最も複雑なオプション。 プロンプト エンジニアリングで問題を解決できる場合は、エージェントは必要ありません。       |

### ツールを使用した単一エージェント

| 項目           | 内容                                                                                                                                                                                                                                 |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 概要           | 使用可能なツール、ナレッジ ソース、API から選択することで、理由と動作を行う 1 つのエージェント。 エージェントは、複数のモデル呼び出しとツール呼び出しをループ処理して結果を絞り込むことができます。                                  |
| いつ使用するか | 注文の状態の検索やデータベースのクエリなど、一部の要求で動的なツールの使用が必要な 1 つのドメイン内のさまざまなクエリ。                                                                                                              |
| 考慮事項       | 多くの場合、エンタープライズ ユース ケースに適した既定値です。 動的ロジックを引き続き許可しながら、マルチエージェントのセットアップよりもデバッグとテストが簡単です。 反復制限を設定して、無限のツール呼び出しループから保護します。 |

### マルチエージェント オーケストレーション

| 項目           | 内容                                                                                                                                                                                                                         |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 概要           | 複数の特殊なエージェントが、問題を解決するために調整します。オーケストレーターまたはピア ベースのプロトコルは、作業の分散、コンテキスト共有、および結果の集計を管理します。                                                  |
| いつ使用するか | 機能間またはクロスドメインの問題、エージェントごとに個別のセキュリティ境界を必要とするシナリオ、または並列特殊化の恩恵を受けるタスク。                                                                                       |
| 考慮事項       | 調整オーバーヘッド、待機時間、および障害モードを追加します。プロンプトの複雑さ、ツールの過負荷、またはセキュリティの要件により、単一のエージェントが確実にタスクを処理できないことを示すことで、追加の複雑さを正当化します。 |

このガイドの残りの部分では、調整の課題が最も重要なマルチエージェント レベルのオーケストレーション パターンに焦点を当てています。

## 概要

複数のエージェントを使用すると、モノリシック シングル エージェント ソリューションと比較して、いくつかの利点があります。

- **専修**：個々のエージェントは、特定のドメインまたは機能に集中できるため、コードとプロンプトの複雑さが軽減されます。
- **スケーラビリティ**：エージェントは、システム全体を再設計せずに追加または変更できます。
- **保守性**：テストとデバッグは個々のエージェントに重点を置くことができるため、これらのタスクの複雑さが軽減されます。
- **最適化**：各エージェントは、個別のモデル、タスク解決アプローチ、知識、ツール、コンピューティングを使用して、その結果を達成できます。

---

### シーケンシャル オーケストレーション

定義済みの線形順序で AI エージェントをチェーンします。 各エージェントは、前のエージェントからの出力をシーケンスで処理し、特殊化された変換のパイプラインを作成します。

#### 使用するタイミング

- 明確な線形依存関係と予測可能なワークフローの進行を持つ
- 並列化できないワークフロー
- 1つの AI エージェントの処理が失敗したり遅延したりしても、タスク全体が完了できるシステム

#### 回避するタイミング

- 並列化できるワークフロー
- 初期段階では、エラーが発生したり、低品質の出力が生成されたりする可能性があり、累積エラー出力を使用して後の手順が処理されないようにする必要がある
- AI エージェントは、作業を引き継ぐのではなく、共同作業を行う必要がある
- ワークフローにはバックトラッキングまたはイテレーションが必要
- 中間結果によって処理の内容が変化する

---

### コンカレント オーケストレーション

同じタスクで複数の AI エージェントを同時に実行します。このパターンは、同じ問題に対して多様な分析情報やアプローチが必要なシナリオに対処します。 順次処理の代わりに、すべてのエージェントが並列に動作するため、全体的な実行時間が短縮され、問題領域が包括的にカバーされます。

エージェントは独立して動作し、結果を互いに引き渡しません。 エージェントは、独立した処理の一部として独自のオーケストレーション アプローチを使用して、追加の AI エージェントを呼び出す場合があります。

#### 使用するタイミング

#### 回避するタイミング

---

### グループチャット オーケストレーション

#### 使用するタイミング

#### 回避するタイミング

---

### ハンドオフ オーケストレーション

#### 使用するタイミング

#### 回避するタイミング

---

### マゼンティック オーケストレーション

#### 使用するタイミング

#### 回避するタイミング

---

| パターン         | 概要                                                                   | 経路選択                                                        | 最適な用途                                                           | 注意点                                                 |
| ---------------- | ---------------------------------------------------------------------- | --------------------------------------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------ |
| シーケンシャル   | 線形パイプライン。各エージェントは、前のエージェントの出力を処理します | 決定論的な定義済みの順序                                        | 明確なステージ依存関係を使用したステップ バイ ステップの絞り込み     | 初期段階での障害が伝播する。並列処理なし               |
| コンカレント     | エージェントは、同じ入力で独立して動作します                           | 決定論的または動的なエージェントの選択                          | 複数の観点からの独立した分析;待機時間に依存するシナリオ              | 結果が矛盾する場合は競合解決が必要です。リソース集中型 |
| グループチャット | エージェントが共有スレッドに貢献する                                   | チャット管理者が順序を制御する                                  | コンセンサス構築、ブレーンストーミング、反復的な作成者チェッカー検証 | 会話ループ。多くのエージェントで制御するのが難しい     |
| ハンドオフ       | 動的委任。一度に 1 つのアクティブなエージェント                        | エージェントが制御を転送するタイミングを決定する                | 処理中に適切なスペシャリストが出現するタスク                         | 無限ハンドオフループ、予期しないルーティング パス      |
| マゼンティック   | マネージャー エージェントによるタスク台帳のビルドと調整                | マネージャー エージェントによるタスクの動的な割り当てと並べ替え | 事前に定義されたソリューション パスのないオープンエンドの問題        | 収束が遅い、あいまいな目標で停滞する                   |
